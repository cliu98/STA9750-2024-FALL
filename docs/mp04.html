<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Liu">

<title>Mini-Project #04: Monte Carlo-Informed Selection of CUNY Retirement Plans – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">

<script src="site_libs/datatables-binding-0.33/datatables.js"></script>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">

<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">

<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>

<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Mini-Project #04: Monte Carlo-Informed Selection of CUNY Retirement Plans</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Chris Liu </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>This mini project will explore an example of personal financial decision making with <code>R</code>. Within the scope of this project, the following will be done:</p>
<ul>
<li>Use a password-protected API to acquire financial data</li>
<li>Use resampling inference to estimate complex probability distributions</li>
<li>See how the optimal financial decision varies as a function of market returns</li>
<li>Investigate how demographic and actuarial assumptions, as well as individual risk-tolerances, change the optimal decision.</li>
</ul>
<p>This will specifically focus on <a href="https://www.cuny.edu/">CUNY</a> employee retirement plans. Newly hired faculty have 30 days to choose between <a href="https://www.cuny.edu/wp-content/uploads/sites/4/page-assets/about/administration/offices/hr/benefits/Benefits-Guide-Retirement-Plans-Final-HEO-and-ECP.pdf">two retirement plans</a>. It can be difficult to assess which plan would be better in the long run dependent on a multitude of factors in life. This project will explore historical financial data and use a bootstrap inference strategy to estimate the probability that one plan is better than the other dependent on circumstances.</p>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<section id="cuny-retirement-plans" class="level4">
<h4 class="anchored" data-anchor-id="cuny-retirement-plans">CUNY Retirement Plans</h4>
<section id="teachers-retirement-system" class="level5">
<h5 class="anchored" data-anchor-id="teachers-retirement-system">Teachers Retirement System</h5>
<p>The first plan CUNY offers is a Teachers Retirement System (TRS) plan. The TRS plan is a traditional pension program, the employer will pay a fraction of the employee’s salary until death. The TRS is a defined benefit plan where the employer takes on the market risk and covers the expenses in the long term if the market under performs.</p>
<p>The TRS plan outline:</p>
<ol type="1">
<li><p>Employees pay a fixed percentage of their paycheck into the pension fund. For CUNY employees joining after March 31, 2012–which you may assume for this project–the so-called “Tier VI” contribution rates are based on the employee’s annual salary and increase as follows:</p>
<ul>
<li>$45,000 or less: 3%</li>
<li>$45,001 to $55,000: 3.5%</li>
<li>$55,001 to $75,000: 4.5%</li>
<li>$75,001 to $100,000: 5.75%</li>
<li>$100,001 or more: 6%</li>
</ul></li>
<li><p>The retirement benefit is calculated based on the <em>Final Average Salary</em> of the employee: following 2024 law changes, the FAS is computed based on the final <em>three</em> years salary. (Previously, FAS was computed based on 5 years: since salaries tend to increase monotonically over time, this is a major win for TRS participants.)</p>
<p>If <span class="math inline">\(N\)</span> is the number of years served, the annual retirement benefit is:</p>
<ul>
<li><span class="math inline">\(1.67\% * \text{FAS} * N\)</span> if <span class="math inline">\(N \leq 20\)</span></li>
<li><span class="math inline">\(1.75\% * \text{FAS} * N\)</span> if <span class="math inline">\(N = 20\)</span></li>
<li><span class="math inline">\((35\% + 2\% * N) * \text{FAS}\)</span> if <span class="math inline">\(N \geq 20\)</span>[^3]</li>
</ul>
<p>In each case, the benefit is paid out equally over 12 months.</p></li>
<li><p>The benefit is increased annually by 50% of the CPI, rounded <em>up</em> to the nearest tenth of a percent: <em>e.g.</em>, a CPI of 2.9% gives an inflation adjustment of 1.5%. The benefit is capped <em>below</em> at 1% and <em>above</em> at 3%, so a CPI of 10% leads to a 3% inflation adjustment while a CPI of 0% leads to a 1% inflation adjustment.</p>
<p>The inflation adjustement is effective each September and the CPI used is the aggregate monthly CPI of the previous 12 months; so the September 2024 adjustment depends on the CPI from September 2023 to August 2024.</p></li>
</ol>
</section>
<section id="optional-retirement-plan" class="level5">
<h5 class="anchored" data-anchor-id="optional-retirement-plan">Optional Retirement Plan</h5>
<p>The optional retirement plan (OPR) is in line with a traditional 401(k) plan. Both the employer and employee make contributions into a retirement account. The investments are made in the employee’s choice of mutual funds. At retirement, the employee will be able to access those funds and withdraw as they like. For this analysis it can be assumed that the investments are made with the following allocation:</p>
<ul>
<li>Age 25 to Age 49:
<ul>
<li>54% US Equities</li>
<li>36% International Equities</li>
<li>10% Bonds</li>
</ul></li>
<li>Age 50 to Age 59:
<ul>
<li>47% US Equities</li>
<li>32% International Equities</li>
<li>21% Bonds</li>
</ul></li>
<li>Age 60 to Age 74:
<ul>
<li>34% US Equities</li>
<li>23% International Equities</li>
<li>43% Bonds</li>
</ul></li>
<li>Age 75 or older:
<ul>
<li>19% US Equities</li>
<li>13% International Equities</li>
<li>62% Bonds</li>
<li>6% Short-Term Debt</li>
</ul></li>
</ul>
<p>Under the ORP, both the employee and the employer make monthly contributions to the employee’s ORP account. These returns are calculated as a percentage of the employee’s annual salary. Specifically, the employee contributes at the same rate as the TRS:</p>
<ul>
<li>$45,000 or less: 3%</li>
<li>$45,001 to $55,000: 3.5%</li>
<li>$55,001 to $75,000: 4.5%</li>
<li>$75,001 to $100,000: 5.75%</li>
<li>$100,001 or more: 6%</li>
</ul>
<p>The employer contribution is fixed at:</p>
<ul>
<li>8% for the first seven years of employment at CUNY.</li>
<li>10% for all years thereafter.</li>
</ul>
<p>You may assume that the contributions are immediately invested according to the asset allocations above.</p>
</section>
<section id="compound-interest" class="level5">
<h5 class="anchored" data-anchor-id="compound-interest">Compound Interest</h5>
<p>The power of compounding interest allows for investments to grow at an exponential rate over time. More detailed explanation of compounding interest can be found <a href="https://www.investopedia.com/terms/c/compoundinterest.asp">here</a>. The final value of the investment should be much greater than what was contributed over time.</p>
</section>
</section>
</section>
</section>
<section id="data-sources" class="level2">
<h2 class="anchored" data-anchor-id="data-sources">Data Sources</h2>
<p>The data sources used in this project will be accessed from Alpha Vantage and the Federal Reserve Economic Data (FRED). A free API key can be obtained for both sites to access the data used in this analysis. All that’s required is to sign up for an account on the site to access the API keys.</p>
<p>The Alpha Vantage API key can be claimed <a href="https://www.alphavantage.co/support/#api-key">here</a> and be used with the <a href="https://www.alphavantage.co/documentation/">supporting documentation</a>.</p>
<p>The FRED API key can be claimed <a href="https://fredaccount.stlouisfed.org/login/secure/">here</a> and be used with the <a href="https://fred.stlouisfed.org/docs/api/fred/">supporting documentation</a>.</p>
<p>The API keys are linked to the account you signed up with. In the following code I provide, I will read into <code>R</code> my API keys from a text file, and reproduction should be done so as well to not publish your personal API key.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 1 &amp; 2</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># import API keys</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>alpha_vantage_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"AlphaVantageAPIKey.txt"</span>, <span class="at">warn =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>] <span class="co"># api key located on first line of txt file</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>FRED_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"FREDAPIKey.txt"</span>, <span class="at">warn =</span> <span class="cn">FALSE</span>)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="analysis" class="level2">
<h2 class="anchored" data-anchor-id="analysis">Analysis</h2>
<p>The following libraries will be used in this project:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-acquisition" class="level3">
<h3 class="anchored" data-anchor-id="data-acquisition">Data Acquisition</h3>
<p>The relevant data series we need to acquire for our analysis is the following:</p>
<ul>
<li>Wage growth</li>
<li>Inflation</li>
<li>US Equity Market total returns</li>
<li>International Equity Market total returns</li>
<li>Bond market total returns</li>
<li>Short-term debt returns</li>
</ul>
<p>The following code chunks will import the data using both the Alpha Vantage API and FRED API. The first four code chunks will import data using the Alpha Vantage API. The last two code chunks will use the FRED API to import the data.</p>
<p>The first data series to be imported will be the US equity market total returns. For the purposes of this project, I will be using SPY as the tracker. There are other equivalent indicators that can be used too.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 3: Data Acquisition</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Alpha Vantage API documentation lets us know exactly what data we can find</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># US Equity Market total returns, represented by SPY for our case</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get TIME_SERIES_DAILY data</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>get_sp500_data <span class="ot">&lt;-</span> <span class="cf">function</span>(api_key) {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_DAILY"</span>, <span class="co"># Backticks for reserved word</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">symbol =</span> <span class="st">"SPY"</span>, <span class="co"># S&amp;P 500 ETF symbol</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">apikey =</span> api_key,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">outputsize =</span> <span class="st">"full"</span>, <span class="co"># Full dataset</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">datatype =</span> <span class="st">"json"</span> <span class="co"># JSON format</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parse the response as JSON</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(response, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>sp500_data <span class="ot">&lt;-</span> <span class="fu">get_sp500_data</span>(alpha_vantage_key)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the time series data</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>spy_time_series <span class="ot">&lt;-</span> sp500_data<span class="sc">$</span><span class="st">`</span><span class="at">Time Series (Daily)</span><span class="st">`</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the nested list to a data frame</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>spy <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, spy_time_series))</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the dates as a column</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>spy <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">date =</span> <span class="fu">rownames</span>(spy), spy)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset rownames</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(spy) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns for the regular time series data</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(spy) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"open"</span>,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"high"</span>,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"low"</span>,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"close"</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"volume"</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns to correct types</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>spy <span class="ot">&lt;-</span> <span class="fu">transform</span>(spy,</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">open =</span> <span class="fu">as.numeric</span>(open),</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">high =</span> <span class="fu">as.numeric</span>(high),</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">low =</span> <span class="fu">as.numeric</span>(low),</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">close =</span> <span class="fu">as.numeric</span>(close),</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">volume =</span> <span class="fu">as.numeric</span>(volume)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The next series to be imported is the international equity market total returns. In this analysis, FDIVX will be used to measure the international market.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># International Equity Market total returns</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to get TIME_SERIES_DAILY data</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>get_FDIVX_data <span class="ot">&lt;-</span> <span class="cf">function</span>(api_key) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TIME_SERIES_DAILY"</span>, <span class="co"># Backticks for reserved word</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">symbol =</span> <span class="st">"FDIVX"</span>, <span class="co"># Fidelity International Growth Fund symbol</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">apikey =</span> api_key,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">outputsize =</span> <span class="st">"full"</span>, <span class="co"># Full dataset</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">datatype =</span> <span class="st">"json"</span> <span class="co"># JSON format</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parse the response as JSON</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(response, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>FDIVX_data <span class="ot">&lt;-</span> <span class="fu">get_FDIVX_data</span>(alpha_vantage_key)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the time series data</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>FDIVX_time_series <span class="ot">&lt;-</span> FDIVX_data<span class="sc">$</span><span class="st">`</span><span class="at">Time Series (Daily)</span><span class="st">`</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the nested list to a data frame</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>FDIVX <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">do.call</span>(rbind, FDIVX_time_series))</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the dates as a column</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>FDIVX <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">date =</span> <span class="fu">rownames</span>(FDIVX), FDIVX)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset rownames</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(FDIVX) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns for the regular time series data</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(FDIVX) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"open"</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"high"</span>,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"low"</span>,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"close"</span>,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"volume"</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert columns to correct types</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>FDIVX <span class="ot">&lt;-</span> <span class="fu">transform</span>(FDIVX,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">open =</span> <span class="fu">as.numeric</span>(open),</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">high =</span> <span class="fu">as.numeric</span>(high),</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">low =</span> <span class="fu">as.numeric</span>(low),</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">close =</span> <span class="fu">as.numeric</span>(close),</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">volume =</span> <span class="fu">as.numeric</span>(volume)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To track inflation, I will use the consumer price index (CPI) as an indicator of inflation over time.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inflation</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>get_inflation_data <span class="ot">&lt;-</span> <span class="cf">function</span>(api_key) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"CPI"</span>, <span class="co"># Backticks for reserved word, CPI is widely regarded as the barometer of inflation levels in the broader economy</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">apikey =</span> api_key,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">outputsize =</span> <span class="st">"full"</span>, <span class="co"># Full dataset</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">datatype =</span> <span class="st">"json"</span> <span class="co"># JSON format</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parse the response as JSON</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(response, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>inflation_data <span class="ot">&lt;-</span> <span class="fu">get_inflation_data</span>(alpha_vantage_key)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>inflation <span class="ot">&lt;-</span> inflation_data<span class="sc">$</span>data</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(inflation) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"index_value"</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>inflation <span class="ot">&lt;-</span> <span class="fu">transform</span>(inflation,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">index_value =</span> <span class="fu">as.numeric</span>(index_value)</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For the short term debt returns, I will be using the 2 year US Treasury Yield as an indicator.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># short-term debt returns, using the 2 year us treasury yield</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>get_short_term_yield_data <span class="ot">&lt;-</span> <span class="cf">function</span>(api_key) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://www.alphavantage.co/query"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">function</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"TREASURY_YIELD"</span>, <span class="co"># Backticks for reserved word</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">maturity =</span> <span class="st">"2year"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">apikey =</span> api_key,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">outputsize =</span> <span class="st">"full"</span>, <span class="co"># Full dataset</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">datatype =</span> <span class="st">"json"</span> <span class="co"># JSON format</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parse the response as JSON</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(response, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>short_term_yield_data <span class="ot">&lt;-</span> <span class="fu">get_short_term_yield_data</span>(alpha_vantage_key)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>short_term_yield <span class="ot">&lt;-</span> short_term_yield_data<span class="sc">$</span>data</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(short_term_yield) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"percent_value"</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>short_term_yield <span class="ot">&lt;-</span> <span class="fu">transform</span>(short_term_yield,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(date),</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">percent_value =</span> <span class="fu">as.numeric</span>(percent_value)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For wage growth, I will be using the median weekly earnings in America. The specific series from FRED is LES1252881600Q.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FRED API documentation isn't as direct as Alpha Vantage's</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Need to search specifically for data of interest to find what we want. This can be done with the API or on the website itself.</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage growth</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>search_fred_series <span class="ot">&lt;-</span> <span class="cf">function</span>(search_text, api_key) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/search"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">api_key =</span> api_key,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file_type =</span> <span class="st">"json"</span>, <span class="co"># Response in JSON format</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">search_text =</span> search_text <span class="co"># keyword to search</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parse the JSON response</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">resp_body_json</span>(response, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract and return the relevant series data</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  series_data <span class="ot">&lt;-</span> data<span class="sc">$</span>seriess</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(series_data)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Search for wage growth-related series using "wage growth"</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>wage_series <span class="ot">&lt;-</span> <span class="fu">search_fred_series</span>(<span class="st">"wage growth"</span>, FRED_key)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># View the first few results</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wage_series[, <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"title"</span>, <span class="st">"frequency"</span>, <span class="st">"units"</span>)])</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># going with FRBATLWGTUMHWGO after looking into it more on FRED site</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co"># function that imports FRED data with series_id</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>fetch_fred_data <span class="ot">&lt;-</span> <span class="cf">function</span>(series_id, api_key) {</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  response <span class="ot">&lt;-</span> <span class="fu">request</span>(<span class="st">"https://api.stlouisfed.org/fred/series/observations"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_url_query</span>(</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">series_id =</span> series_id, <span class="co"># Use the provided series_id</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">api_key =</span> api_key, <span class="co"># Use the provided API key</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">file_type =</span> <span class="st">"json"</span> <span class="co"># Desired file type (json in this case)</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">req_perform</span>()</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Parse the JSON response</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> response <span class="sc">|&gt;</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resp_body_json</span>()</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the observations data from the response</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  observations <span class="ot">&lt;-</span> data<span class="sc">$</span>observations</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert the data into a data frame for easier manipulation</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">sapply</span>(observations, <span class="cf">function</span>(x) x<span class="sc">$</span>date),</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">sapply</span>(observations, <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(x<span class="sc">$</span>value))</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the data frame</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function with a specific series_id FRBATLWGTUMHWGO: Median weekly earnings quarterly</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>wage_growth <span class="ot">&lt;-</span> <span class="fu">fetch_fred_data</span>(<span class="st">"FRBATLWGTUMHWGO"</span>, FRED_key)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(wage_growth) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>,</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wage_percent_change_from_a_year_ago"</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>wage_growth <span class="ot">&lt;-</span> <span class="fu">transform</span>(wage_growth,</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(date)</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To track bond market total returns, the GS10 (Market Yield on 10 year U.S. Treasury Securities) will be used.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bond market total returns, will use GS10 as it is a good indicator in the bond market overall</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>bond_returns <span class="ot">&lt;-</span> <span class="fu">fetch_fred_data</span>(<span class="st">"GS10"</span>, FRED_key)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(bond_returns) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"date"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"percent_value"</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>bond_returns <span class="ot">&lt;-</span> <span class="fu">transform</span>(bond_returns,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(date)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now that all the necessary data series have been imported, the next step is to combine everything into a single data frame to analyze. Unfortunately, all the data series do not use the same measurements of time and units of measurement. For example the SPY series is on a daily basis with multiple measurements of the share price namely in USD. The wage growth series operates under a quarterly time basis, CPI is measured as an index and so on. The following code will take into consideration all these circumstances and join them together as best as possible. The combined data will be aggregated over a monthly basis over 20 years of available data. The date range will be from October 2004 until October 2024.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lets bring these together all into one data frame, monthly should be fine since we're doing a long run analysis over 20 years and will bootstrap</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># defining 20 year range to be 10/1/2004 to 10/1/2024</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust SPY to monthly and return per share</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>spy_monthly <span class="ot">&lt;-</span> spy <span class="sc">|&gt;</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2004-09-30"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2024-10-02"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">date =</span> <span class="fu">floor_date</span>(date, <span class="st">"month"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">spy_average_close =</span> <span class="fu">round</span>(<span class="fu">mean</span>(close), <span class="dv">2</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">US_Equity_Total_Returns_USD =</span> <span class="dv">100</span> <span class="sc">*</span> (spy_average_close <span class="sc">-</span> <span class="fu">lag</span>(spy_average_close)) <span class="sc">/</span> <span class="fu">lag</span>(spy_average_close)) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">US_Equity_Total_Returns_USD =</span> <span class="fu">round</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(US_Equity_Total_Returns_USD), <span class="dv">0</span>, US_Equity_Total_Returns_USD), <span class="dv">2</span>)) <span class="co"># Rounding after replacing NA</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(spy_monthly)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust FDIVX to monthly and return per share</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>FDIVX_monthly <span class="ot">&lt;-</span> FDIVX <span class="sc">|&gt;</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2004-09-30"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2024-10-02"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">date =</span> <span class="fu">floor_date</span>(date, <span class="st">"month"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">FDIVX_average_close =</span> <span class="fu">round</span>(<span class="fu">mean</span>(close), <span class="dv">2</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">International_Equity_Total_Returns_USD =</span> <span class="dv">100</span> <span class="sc">*</span> (FDIVX_average_close <span class="sc">-</span> <span class="fu">lag</span>(FDIVX_average_close)) <span class="sc">/</span> <span class="fu">lag</span>(FDIVX_average_close)) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">International_Equity_Total_Returns_USD =</span> <span class="fu">round</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(International_Equity_Total_Returns_USD), <span class="dv">0</span>, International_Equity_Total_Returns_USD), <span class="dv">2</span>)) <span class="co"># Rounding after replacing NA</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(FDIVX_monthly)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust inflation to join, should in theory be an average since its a monthly value &amp; convert to a percentage</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>inflation_monthly <span class="ot">&lt;-</span> inflation <span class="sc">|&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2004-09-30"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2024-10-02"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">inflation_index_value =</span> index_value) <span class="sc">|&gt;</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">inflation_percent_change =</span> <span class="fu">round</span>((inflation_index_value <span class="sc">/</span> <span class="fu">lag</span>(inflation_index_value) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>))</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust short term yield to join, should in theory be an average since its a monthly value</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>short_term_yield_monthly <span class="ot">&lt;-</span> short_term_yield <span class="sc">|&gt;</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2004-09-30"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2024-10-02"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">short_term_yield_percent_value =</span> percent_value)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust wage growth </span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>wage_growth_monthly <span class="ot">&lt;-</span> wage_growth <span class="sc">|&gt;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2004-09-30"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2024-10-02"</span>))</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust bond returns, should be an average in theory</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>bond_returns_monthly <span class="ot">&lt;-</span> bond_returns <span class="sc">|&gt;</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;</span> <span class="fu">as.Date</span>(<span class="st">"2004-09-30"</span>) <span class="sc">&amp;</span> date <span class="sc">&lt;</span> <span class="fu">as.Date</span>(<span class="st">"2024-10-02"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">bond_return_percent_value =</span> percent_value)</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="co"># join all into one df</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>historical_financial_series <span class="ot">&lt;-</span> spy_monthly <span class="sc">|&gt;</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(FDIVX_monthly, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(inflation_monthly, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(short_term_yield_monthly, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wage_growth_monthly, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(bond_returns_monthly, <span class="at">by =</span> <span class="st">"date"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">spy_return_percent =</span> <span class="fu">round</span>(US_Equity_Total_Returns_USD <span class="sc">/</span> <span class="fu">lag</span>(spy_average_close),<span class="dv">4</span>),</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">spy_return_percent =</span> <span class="fu">replace</span>(spy_return_percent, <span class="fu">is.na</span>(spy_return_percent), <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FDIVX_return_percent =</span> <span class="fu">round</span>(International_Equity_Total_Returns_USD <span class="sc">/</span> <span class="fu">lag</span>(FDIVX_average_close),<span class="dv">4</span>),</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">FDIVX_return_percent =</span> <span class="fu">replace</span>(FDIVX_return_percent, <span class="fu">is.na</span>(FDIVX_return_percent), <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here is a sample table with randomly selected data points of what the combined data frame looks like.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample_n</span>(historical_financial_series, <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> date,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">SPY Value USD</span><span class="st">`</span> <span class="ot">=</span> spy_average_close,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">US Equity Return USD Per Share</span><span class="st">`</span> <span class="ot">=</span> US_Equity_Total_Returns_USD,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">US Equity Return % Per Share</span><span class="st">`</span> <span class="ot">=</span> spy_return_percent,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">FDIVX Value USD</span><span class="st">`</span> <span class="ot">=</span> FDIVX_average_close,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">International Equity Return USD Per Share</span><span class="st">`</span> <span class="ot">=</span> International_Equity_Total_Returns_USD,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">International Equity Return % Per Share</span><span class="st">`</span> <span class="ot">=</span> FDIVX_return_percent,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Inflation Index Value</span><span class="st">`</span> <span class="ot">=</span> inflation_index_value,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Inflation Change %</span><span class="st">`</span> <span class="ot">=</span> inflation_percent_change,</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Short Term Yield Return %</span><span class="st">`</span> <span class="ot">=</span> short_term_yield_percent_value,</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Wage Growth % Change From Last Year</span><span class="st">`</span> <span class="ot">=</span> wage_percent_change_from_a_year_ago,</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Bond Return %</span><span class="st">`</span> <span class="ot">=</span> bond_return_percent_value</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(<span class="at">caption =</span> <span class="st">"Sample Overview of Historical Financial Data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-8378ea7fb5480c640877" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8378ea7fb5480c640877">{"x":{"filter":"none","vertical":false,"caption":"<caption>Sample Overview of Historical Financial Data<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10"],["2005-08-01","2018-11-01","2013-05-01","2023-04-01","2015-04-01","2022-03-01","2011-07-01","2009-07-01","2008-07-01","2018-04-01"],[122.7,272.21,164.19,410.92,209.32,438.15,132.58,93.58,125.63,264.86],[0.29,-2.07,4.59,3.76,0.5600000000000001,-0.99,2.82,0.76,-6.43,-1.9],[30.59,35.88,33.07,40.15,37.71,41.46,31.05,23.76,34.69,39.61],[4.51,-2.71,4.62,4.48,2.75,-5.21,1.77,1.06,-6.72,-0.25],[196.4,252.038,232.945,303.363,236.599,287.504,225.922,215.351,219.964,250.546],[-1.21,0.32,-0.24,-0.25,-0.51,-0.5600000000000001,-0.28,-0.22,0.4,-0.41],[4.04,2.86,0.25,4.02,0.54,1.91,0.41,1.02,2.57,2.38],[4,4.1,2.3,5.1,3.6,5.7,2.2,2.7,4,3],[4.26,3.12,1.93,3.46,1.94,2.13,3,3.56,4.01,2.87],[0.0024,-0.0074,0.0292,0.0095,0.0027,-0.0022,0.0219,0.008200000000000001,-0.0479,-0.007],[0.1541,-0.0735,0.1462,0.1166,0.07489999999999999,-0.1191,0.058,0.0451,-0.1807,-0.0063]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Date<\/th>\n      <th>SPY Value USD<\/th>\n      <th>US Equity Return USD Per Share<\/th>\n      <th>FDIVX Value USD<\/th>\n      <th>International Equity Return USD Per Share<\/th>\n      <th>Inflation Index Value<\/th>\n      <th>Inflation Change %<\/th>\n      <th>Short Term Yield Return %<\/th>\n      <th>Wage Growth % Change From Last Year<\/th>\n      <th>Bond Return %<\/th>\n      <th>US Equity Return % Per Share<\/th>\n      <th>International Equity Return % Per Share<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9,10,11,12]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Date","targets":1},{"name":"SPY Value USD","targets":2},{"name":"US Equity Return USD Per Share","targets":3},{"name":"FDIVX Value USD","targets":4},{"name":"International Equity Return USD Per Share","targets":5},{"name":"Inflation Index Value","targets":6},{"name":"Inflation Change %","targets":7},{"name":"Short Term Yield Return %","targets":8},{"name":"Wage Growth % Change From Last Year","targets":9},{"name":"Bond Return %","targets":10},{"name":"US Equity Return % Per Share","targets":11},{"name":"International Equity Return % Per Share","targets":12}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="investigation-and-visualization-of-input-data" class="level3">
<h3 class="anchored" data-anchor-id="investigation-and-visualization-of-input-data">Investigation and Visualization of Input Data</h3>
<p>Now that the data is ready to be analyzed, some exploratory analysis can help us gain some insights into the different data series.</p>
<section id="long-run-monthly-averages" class="level4">
<h4 class="anchored" data-anchor-id="long-run-monthly-averages">Long Run Monthly Averages</h4>
<p>The first insight to uncover is the long run monthly averages of each data series.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>long_run_monthly_averages <span class="ot">&lt;-</span> historical_financial_series <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_us_equity_return =</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">round</span>(<span class="fu">mean</span>(spy_return_percent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),<span class="dv">4</span>),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_international_equity_return =</span> <span class="dv">100</span><span class="sc">*</span><span class="fu">round</span>(<span class="fu">mean</span>(FDIVX_return_percent, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) ,<span class="dv">4</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_bond_return =</span> <span class="fu">round</span>(<span class="fu">mean</span>(bond_return_percent_value),<span class="dv">2</span>), <span class="co"># a percentage</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_short_term_yield_return =</span> <span class="fu">round</span>(<span class="fu">mean</span>(short_term_yield_percent_value),<span class="dv">2</span>), <span class="co"># a percentage</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_inflation_change =</span> <span class="fu">round</span>(<span class="fu">abs</span>(<span class="fu">mean</span>(inflation_percent_change, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),<span class="dv">2</span>), <span class="co"># a percentage</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_median_wage_change =</span> <span class="fu">round</span>(<span class="fu">mean</span>(wage_percent_change_from_a_year_ago, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),<span class="dv">2</span>) <span class="co"># a percentage</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># creating new df for renaming purposes for data table display only, keeping original since it'll be easier to type the variables out later for other analysis</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>long_run_monthly_averages_dt <span class="ot">&lt;-</span> long_run_monthly_averages <span class="sc">|&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Average US Equity Return (%)</span><span class="st">`</span> <span class="ot">=</span> avg_us_equity_return,</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Average International Equity Return (%)</span><span class="st">`</span> <span class="ot">=</span> avg_international_equity_return,</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Average Bond Return (%)</span><span class="st">`</span> <span class="ot">=</span> avg_bond_return,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Average Short Term Yield Return (%)</span><span class="st">`</span> <span class="ot">=</span> avg_short_term_yield_return,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Average Inflation Change (%)</span><span class="st">`</span> <span class="ot">=</span> avg_inflation_change,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Average Median Wage Change From a Year Ago(%)</span><span class="st">`</span> <span class="ot">=</span> avg_median_wage_change,</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(long_run_monthly_averages_dt, <span class="at">caption =</span> <span class="st">"Long Run Monthly Averages"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c285df22c45ccef2c054" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c285df22c45ccef2c054">{"x":{"filter":"none","vertical":false,"caption":"<caption>Long Run Monthly Averages<\/caption>","data":[["1"],[0.39],[1.35],[2.91],[1.9],[0.21],[3.51]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Average US Equity Return (%)<\/th>\n      <th>Average International Equity Return (%)<\/th>\n      <th>Average Bond Return (%)<\/th>\n      <th>Average Short Term Yield Return (%)<\/th>\n      <th>Average Inflation Change (%)<\/th>\n      <th>Average Median Wage Change From a Year Ago(%)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Average US Equity Return (%)","targets":1},{"name":"Average International Equity Return (%)","targets":2},{"name":"Average Bond Return (%)","targets":3},{"name":"Average Short Term Yield Return (%)","targets":4},{"name":"Average Inflation Change (%)","targets":5},{"name":"Average Median Wage Change From a Year Ago(%)","targets":6}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="correlation-factors" class="level4">
<h4 class="anchored" data-anchor-id="correlation-factors">Correlation Factors</h4>
<p>Next, we examine the correlation factors among the different data series.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># correlations</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>correlation_data <span class="ot">&lt;-</span> historical_financial_series <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>date, <span class="sc">-</span>inflation_percent_change, <span class="sc">-</span>US_Equity_Total_Returns_USD, <span class="sc">-</span>International_Equity_Total_Returns_USD, <span class="sc">-</span>spy_return_percent, <span class="sc">-</span>FDIVX_return_percent) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">`</span><span class="at">SPY Share Value</span><span class="st">`</span> <span class="ot">=</span> spy_average_close,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">FDIVX Share Value</span><span class="st">`</span> <span class="ot">=</span> FDIVX_average_close,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Inflation Index</span><span class="st">`</span> <span class="ot">=</span> inflation_index_value,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Short Term Yield</span><span class="st">`</span> <span class="ot">=</span> short_term_yield_percent_value,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Wage Growth</span><span class="st">`</span> <span class="ot">=</span> wage_percent_change_from_a_year_ago,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Bond Return</span><span class="st">`</span> <span class="ot">=</span> bond_return_percent_value)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cor</span>(correlation_data),<span class="dv">2</span>) <span class="co"># using statistical correlation function</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># convert matrix to a long-format data frame for plotting</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.table</span>(correlation_matrix))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># heat map with ggplot2</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(correlation_df, <span class="fu">aes</span>(Var1, Var2, <span class="at">fill =</span> Freq)) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span>  <span class="co"># Tile borders</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"green"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>, <span class="at">fill =</span> <span class="st">"Correlation"</span>) <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see visually in the heat map how some factors are high correlated with each other while some have no correlation at all. Bond returns only have a significant correlation with the short term yield return. In theory this makes sense since they are both considered safe investment vehicles with low volatility. The value of SPY is highly correlated with the international market and inflation index, giving us insight into how the economy interacts with each other. Wage growth has some correlation with the other factors, however this correlation is relatively small in terms of meaningfulness. It seems that historically wage growth is not progressing as far as it needs to be compared to other financial factors.</p>
</section>
<section id="variances" class="level4">
<h4 class="anchored" data-anchor-id="variances">Variances</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># variances</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># probably makes sense to conduct variance analysis on percentages/returns only</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">US Equity Total Returns Variance</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">var</span>(historical_financial_series<span class="sc">$</span>spy_return_percent),<span class="dv">4</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">International Equity Total Returns Variance</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">var</span>(historical_financial_series<span class="sc">$</span>FDIVX_return_percent),<span class="dv">4</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Inflation Variance</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">var</span>(historical_financial_series<span class="sc">$</span>inflation_percent_change, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),<span class="dv">2</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Wage Growth Variance</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">var</span>(historical_financial_series<span class="sc">$</span>wage_percent_change_from_a_year_ago, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),<span class="dv">2</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Short Term Yield Variance</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">var</span>(historical_financial_series<span class="sc">$</span>short_term_yield_percent_value),<span class="dv">2</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Bond Return Variance</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">var</span>(historical_financial_series<span class="sc">$</span>bond_return_percent_value),<span class="dv">2</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>series_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"US Equity Total Returns Variance"</span>, </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"International Equity Total Returns Variance"</span>, </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Inflation Variance"</span>, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Wage Growth Variance"</span>, </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Short Term Yield Variance"</span>, </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"Bond Return Variance"</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># combine into a data frame</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>variance_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Series =</span> series_names,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                            <span class="at">Variance =</span> <span class="fu">c</span>(</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">US Equity Total Returns Variance</span><span class="st">`</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">International Equity Total Returns Variance</span><span class="st">`</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">Inflation Variance</span><span class="st">`</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">Wage Growth Variance</span><span class="st">`</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">Short Term Yield Variance</span><span class="st">`</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                              <span class="st">`</span><span class="at">Bond Return Variance</span><span class="st">`</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                            ))</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(variance_data, <span class="at">caption =</span> <span class="st">"Data Series Variance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-5ad4711c96b3edd9ded8" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5ad4711c96b3edd9ded8">{"x":{"filter":"none","vertical":false,"caption":"<caption>Data Series Variance<\/caption>","data":[["1","2","3","4","5","6"],["US Equity Total Returns Variance","International Equity Total Returns Variance","Inflation Variance","Wage Growth Variance","Short Term Yield Variance","Bond Return Variance"],[0.0005999999999999999,0.0192,0.16,1.41,2.75,1.25]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Series<\/th>\n      <th>Variance<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Series","targets":1},{"name":"Variance","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Insert commentary about variance. I might want to change the variance of the first two to the percent return to align with the other data points.</p>
</section>
</section>
<section id="historical-comparison-of-trs-and-orp" class="level3">
<h3 class="anchored" data-anchor-id="historical-comparison-of-trs-and-orp">Historical Comparison of TRS and ORP</h3>
<p>The next step is to compare the values of the TRS and OPR plans for the first month of retirement. To do so, some assumptions will need to be made about this employee being examined. It will be assumed the the employee joined CUNY on the first month of the data set and retired on the last month of the data set. Their starting salary will be set at $60,000 and they began their tenure at age 42.</p>
<p>First we will examine the TRS plan:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 5: Historical Comparison</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># set starting salary</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>starting_salary <span class="ot">&lt;-</span> <span class="dv">60000</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co"># define tenure of job before retirement (start of data to end of data)</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>years_worked <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">max</span>(historical_financial_series<span class="sc">$</span>date), <span class="fu">min</span>(historical_financial_series<span class="sc">$</span>date)))<span class="sc">/</span><span class="dv">365</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># define salary earned in entire tenure, based on the long run monthly average of wage growth of 3.51%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>salary_growth_rate <span class="ot">&lt;-</span> <span class="fl">0.0351</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>tenured_salary <span class="ot">&lt;-</span> starting_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> salary_growth_rate)<span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span>years_worked)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"># TRS Plan</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># assuming the employee gets the full benefit of (35% + 2%*N) * FAS</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"># define FAS as the average of the last 3 years of salary before retirement</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>FAS <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">tail</span>(tenured_salary,<span class="dv">3</span>))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># the annual retirement benefit</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>annual_retirement_benefit <span class="ot">=</span> (<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.02</span><span class="sc">*</span>years_worked)<span class="sc">*</span>FAS</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co"># inflation adjustment is made to the annual retirement benefit annually, this will be taken into consideration later in the analysis</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># first month's retirement income</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>TRS_first_month_value <span class="ot">=</span> <span class="fu">round</span>(annual_retirement_benefit<span class="sc">/</span><span class="dv">12</span>,<span class="dv">0</span>) <span class="co"># round to the nearest dollar</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The estimated benefit during the first month of retirement with the TRS plan is $"</span>, TRS_first_month_value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The estimated benefit during the first month of retirement with the TRS plan is $ 7225"</code></pre>
</div>
</div>
<p>Next we can compare this to the OPR plan:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OPR Plan</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># making assumptions here, lets say the employee is hired at age 42 and retires at 62</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the retirement data frame</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>retirement_account <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(historical_financial_series), <span class="co"># of months contributions are made  </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize columns for each asset return</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">allocation_us =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)), </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">allocation_international =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)),</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">allocation_bonds =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)),</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">allocation_short_term =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the assets returns based on historical data, dividing to get decimal value</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">us_returns =</span> historical_financial_series<span class="sc">$</span>spy_return_percent<span class="sc">/</span><span class="dv">100</span>, </span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">international_returns =</span> historical_financial_series<span class="sc">$</span>FDIVX_return_percent<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">bonds_returns =</span> historical_financial_series<span class="sc">$</span>bond_return_percent_value<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">short_term_returns =</span> historical_financial_series<span class="sc">$</span>short_term_yield_percent_value<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize columns for contributions made</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">contribution_employee =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)), </span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">contribution_employer =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series))</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># populate contributions and allocations as before</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (month <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(retirement_account)) {</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(month <span class="sc">/</span> <span class="dv">12</span>) <span class="co"># round to the closest year to define number of years worked</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  age <span class="ot">&lt;-</span> <span class="dv">42</span> <span class="sc">+</span> (year <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># assuming employee starts at age 42</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  annual_salary <span class="ot">&lt;-</span> tenured_salary[year] <span class="co"># grab the salary dependent on work year</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate contributions based on salary bracket</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">45000</span>) {</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.03</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">55000</span>) {</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.035</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">75000</span>) {</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.045</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">100000</span>) {</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.0575</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.06</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>  retirement_account<span class="sc">$</span>contribution_employer[month] <span class="ot">&lt;-</span> <span class="cf">if</span> (year <span class="sc">&lt;=</span> <span class="dv">7</span>) annual_salary <span class="sc">*</span> <span class="fl">0.08</span> <span class="sc">/</span> <span class="dv">12</span> <span class="cf">else</span> annual_salary <span class="sc">*</span> <span class="fl">0.10</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define allocations based on age</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">49</span>) {</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.54</span></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.36</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.10</span></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">59</span>) {</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.47</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.32</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.21</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">74</span>) {</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.34</span></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.23</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.43</span></span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.19</span></span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.13</span></span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.62</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.06</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate future value using compound interest</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>retirement_account_value <span class="ot">&lt;-</span> retirement_account <span class="sc">|&gt;</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># total contribution per month</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">contribution_total =</span> contribution_employee <span class="sc">+</span> contribution_employer,</span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># net total return factors for each asset with compounding</span></span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_return_us =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(us_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_return_international =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(international_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_return_bonds =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(bonds_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_return_short_term =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(short_term_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># future value of contributions per asset class</span></span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">fv_us =</span> contribution_total <span class="sc">*</span> allocation_us <span class="sc">*</span> net_return_us,</span>
<span id="cb16-83"><a href="#cb16-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">fv_international =</span> contribution_total <span class="sc">*</span> allocation_international <span class="sc">*</span> net_return_international,</span>
<span id="cb16-84"><a href="#cb16-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">fv_bonds =</span> contribution_total <span class="sc">*</span> allocation_bonds <span class="sc">*</span> net_return_bonds,</span>
<span id="cb16-85"><a href="#cb16-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">fv_short_term =</span> contribution_total <span class="sc">*</span> allocation_short_term <span class="sc">*</span> net_return_short_term</span>
<span id="cb16-86"><a href="#cb16-86" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-87"><a href="#cb16-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb16-88"><a href="#cb16-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">future_value =</span> <span class="fu">sum</span>(fv_us <span class="sc">+</span> fv_international <span class="sc">+</span> fv_bonds <span class="sc">+</span> fv_short_term) <span class="co"># total future value of the retirement account</span></span>
<span id="cb16-89"><a href="#cb16-89" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb16-90"><a href="#cb16-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-91"><a href="#cb16-91" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The estimated retirement account value at the first month of retirement with the OPR plan is $"</span>, <span class="fu">round</span>(retirement_account_value,<span class="dv">0</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The estimated retirement account value at the first month of retirement with the OPR plan is $ 2061342"</code></pre>
</div>
</div>
<p>We can see that the OPR plan yields more value in the first month of retirement. However, we need to analyze the yields even further into the future to get a better understanding about which plan may be more suitable for a potential employee. Keep in mind that the final value of the OPR plan is how much that person has for the remainder of their life and can be exhausted. The money can be used however they like in terms of withdrawal, and the value will continue to grow annually dependent on the equity allocations. On the other hand, the TRS plan guarantees that same income value monthly (adjusted for inflation annually) until death.</p>
</section>
<section id="long-term-average-analysis" class="level3">
<h3 class="anchored" data-anchor-id="long-term-average-analysis">Long-Term Average Analysis</h3>
<p>Now we will modify our analysis from above to look at the plans in a different timeline, from retirement until death. Life expectancy unpredictable and is a result of multiple factors. For this analysis, we’ll arbitrarily define the life expectancy to be 80 years old.</p>
<p>Looking at the TRS plan:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 6: Fixed-Rate Analysis</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># TRS inflation adjusted for the next 18 years</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The benefit is increased annually by 50% of the CPI, rounded up to the nearest tenth of a percent</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>CPI_benefit <span class="ot">=</span> <span class="fu">round</span>((long_run_monthly_averages<span class="sc">$</span>avg_inflation_change<span class="sc">*</span><span class="dv">12</span>)<span class="sc">/</span><span class="dv">2</span>,<span class="dv">1</span>)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>annual_retirement_benefit_inflation_adjusted <span class="ot">=</span> <span class="fu">round</span>(annual_retirement_benefit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> CPI_benefit)<span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">17</span>), <span class="dv">0</span>) <span class="co"># (0:17) creates a vector for the next 18 years of inflation adjusted income</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># monthly retirement income in each year</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>monthly_annual_retirement_benefit_inflation_adjusted <span class="ot">=</span> <span class="fu">round</span>(annual_retirement_benefit_inflation_adjusted<span class="sc">/</span><span class="dv">12</span>,<span class="dv">0</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># average monthly income post retirement</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>TRS_avg_monthly_income <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(monthly_annual_retirement_benefit_inflation_adjusted),<span class="dv">0</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the numeric vector to a data frame with ages</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>annual_retirement_benefit_inflation_adjusted <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="dv">63</span><span class="sc">:</span><span class="dv">80</span>, <span class="co"># Create a column for ages from 63 to 80</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">annual_benefit =</span> annual_retirement_benefit_inflation_adjusted,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">monthly_benefit =</span> <span class="fu">round</span>(annual_retirement_benefit_inflation_adjusted<span class="sc">/</span><span class="dv">12</span>,<span class="dv">0</span>)</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co"># new variable for display purposes only</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>annual_retirement_benefit_inflation_adjusted_dt <span class="ot">&lt;-</span> annual_retirement_benefit_inflation_adjusted <span class="sc">|&gt;</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> age,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Annual Benefit (USD)</span><span class="st">`</span> <span class="ot">=</span> annual_benefit,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Monthly Benefit (USD)</span><span class="st">`</span> <span class="ot">=</span> monthly_benefit</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(annual_retirement_benefit_inflation_adjusted_dt, <span class="at">caption =</span> <span class="st">"TRS Benefit During Retirement"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-96577ffcc56f4dcefda9" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-96577ffcc56f4dcefda9">{"x":{"filter":"none","vertical":false,"caption":"<caption>TRS Benefit During Retirement<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],[63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80],[86706,87833,88975,90132,91303,92490,93693,94911,96144,97394,98660,99943,101242,102558,103892,105242,106610,107996],[7226,7319,7415,7511,7609,7708,7808,7909,8012,8116,8222,8329,8437,8546,8658,8770,8884,9000]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Age<\/th>\n      <th>Annual Benefit (USD)<\/th>\n      <th>Monthly Benefit (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Age","targets":1},{"name":"Annual Benefit (USD)","targets":2},{"name":"Monthly Benefit (USD)","targets":3}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Looking at the OPR plan:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### reloading data from last chunk in this new chunk to keep variables going</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># making assumptions here, lets say the employee is hired at age 42 and retires at 62</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize the retirement data frame</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>retirement_account <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">period =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(historical_financial_series), <span class="co"># of months contributions are made  </span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize columns for each asset return</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">allocation_us =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)), </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">allocation_international =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">allocation_bonds =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">allocation_short_term =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the assets returns based on historical data, dividing to get decimal value</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">us_returns =</span> historical_financial_series<span class="sc">$</span>spy_return_percent<span class="sc">/</span><span class="dv">100</span>, </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">international_returns =</span> historical_financial_series<span class="sc">$</span>FDIVX_return_percent<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">bonds_returns =</span> historical_financial_series<span class="sc">$</span>bond_return_percent_value<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">short_term_returns =</span> historical_financial_series<span class="sc">$</span>short_term_yield_percent_value<span class="sc">/</span><span class="dv">100</span>,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize columns for contributions made</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">contribution_employee =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series)), </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">contribution_employer =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(historical_financial_series))</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="co"># populate contributions and allocations as before</span></span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (month <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(retirement_account)) {</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(month <span class="sc">/</span> <span class="dv">12</span>) <span class="co"># round to the closest year to define number of years worked</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  age <span class="ot">&lt;-</span> <span class="dv">42</span> <span class="sc">+</span> (year <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># assuming employee starts at age 42</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  annual_salary <span class="ot">&lt;-</span> tenured_salary[year] <span class="co"># grab the salary dependent on work year</span></span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate contributions based on salary bracket</span></span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">45000</span>) {</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.03</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">55000</span>) {</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.035</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">75000</span>) {</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.045</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">100000</span>) {</span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.0575</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.06</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>  retirement_account<span class="sc">$</span>contribution_employer[month] <span class="ot">&lt;-</span> <span class="cf">if</span> (year <span class="sc">&lt;=</span> <span class="dv">7</span>) annual_salary <span class="sc">*</span> <span class="fl">0.08</span> <span class="sc">/</span> <span class="dv">12</span> <span class="cf">else</span> annual_salary <span class="sc">*</span> <span class="fl">0.10</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define allocations based on age</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">49</span>) {</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.54</span></span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.36</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.10</span></span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">59</span>) {</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.47</span></span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.32</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.21</span></span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">74</span>) {</span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.34</span></span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.23</span></span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.43</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.19</span></span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.13</span></span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.62</span></span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.06</span></span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate future value using compound interest</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>retirement_account_value <span class="ot">&lt;-</span> retirement_account <span class="sc">|&gt;</span></span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># total contribution per month</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">contribution_total =</span> contribution_employee <span class="sc">+</span> contribution_employer,</span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>    <span class="co"># net total return factors for each asset with compounding</span></span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_return_us =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(us_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_return_international =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(international_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_return_bonds =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(bonds_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">net_return_short_term =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(short_term_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># future value of contributions per asset class</span></span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">fv_us =</span> contribution_total <span class="sc">*</span> allocation_us <span class="sc">*</span> net_return_us,</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">fv_international =</span> contribution_total <span class="sc">*</span> allocation_international <span class="sc">*</span> net_return_international,</span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">fv_bonds =</span> contribution_total <span class="sc">*</span> allocation_bonds <span class="sc">*</span> net_return_bonds,</span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">fv_short_term =</span> contribution_total <span class="sc">*</span> allocation_short_term <span class="sc">*</span> net_return_short_term</span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">account_value =</span> <span class="fu">sum</span>(fv_us <span class="sc">+</span> fv_international <span class="sc">+</span> fv_bonds <span class="sc">+</span> fv_short_term) <span class="co"># total future value of the retirement account</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a><span class="do">####</span></span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a><span class="co"># OPR for the next 18 years</span></span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial account value at retirement</span></span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>post_retirement_account_value <span class="ot">&lt;-</span> retirement_account_value</span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the withdrawal rate (4%)</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.04</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty data frame to store results</span></span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>post_retirement_account_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="fu">integer</span>(), <span class="at">account_value =</span> <span class="fu">numeric</span>())</span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize previous_account_value to store the starting value</span></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>previous_account_value <span class="ot">&lt;-</span> post_retirement_account_value</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a loop for each year of retirement (from age 62 to 80)</span></span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (age <span class="cf">in</span> <span class="dv">62</span><span class="sc">:</span><span class="dv">80</span>) {</span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the annual withdrawal based on the previous year's account value</span></span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>  annual_withdrawal <span class="ot">&lt;-</span> previous_account_value <span class="sc">*</span> withdrawal_rate</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subtract the withdrawal before applying growth</span></span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>  post_retirement_account_value <span class="ot">&lt;-</span> previous_account_value <span class="sc">-</span> annual_withdrawal</span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define allocations based on age</span></span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">74</span>) {</span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>    post_allocation_us <span class="ot">&lt;-</span> <span class="fl">0.34</span></span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>    post_allocation_international <span class="ot">&lt;-</span> <span class="fl">0.23</span></span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a>    post_allocation_bonds <span class="ot">&lt;-</span> <span class="fl">0.43</span></span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a>    post_allocation_short_term <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>    post_allocation_us <span class="ot">&lt;-</span> <span class="fl">0.19</span></span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>    post_allocation_international <span class="ot">&lt;-</span> <span class="fl">0.13</span></span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>    post_allocation_bonds <span class="ot">&lt;-</span> <span class="fl">0.62</span></span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a>    post_allocation_short_term <span class="ot">&lt;-</span> <span class="fl">0.06</span></span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the asset returns (adjusted for decimal values)</span></span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a>  us_returns <span class="ot">&lt;-</span> historical_financial_series<span class="sc">$</span>spy_return_percent <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a>  international_returns <span class="ot">&lt;-</span> historical_financial_series<span class="sc">$</span>FDIVX_return_percent <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a>  bonds_returns <span class="ot">&lt;-</span> historical_financial_series<span class="sc">$</span>bond_return_percent_value <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a>  short_term_returns <span class="ot">&lt;-</span> historical_financial_series<span class="sc">$</span>short_term_yield_percent_value <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust for monthly growth using returns (assuming monthly data for growth)</span></span>
<span id="cb19-139"><a href="#cb19-139" aria-hidden="true" tabindex="-1"></a>  post_net_return_us <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(us_returns, <span class="at">default =</span> <span class="dv">0</span>))  </span>
<span id="cb19-140"><a href="#cb19-140" aria-hidden="true" tabindex="-1"></a>  post_net_return_international <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(international_returns, <span class="at">default =</span> <span class="dv">0</span>))  </span>
<span id="cb19-141"><a href="#cb19-141" aria-hidden="true" tabindex="-1"></a>  post_net_return_bonds <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(bonds_returns, <span class="at">default =</span> <span class="dv">0</span>))  </span>
<span id="cb19-142"><a href="#cb19-142" aria-hidden="true" tabindex="-1"></a>  post_net_return_short_term <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(short_term_returns, <span class="at">default =</span> <span class="dv">0</span>))  </span>
<span id="cb19-143"><a href="#cb19-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-144"><a href="#cb19-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the future value per asset class for the current year</span></span>
<span id="cb19-145"><a href="#cb19-145" aria-hidden="true" tabindex="-1"></a>  post_fv_us <span class="ot">&lt;-</span> post_retirement_account_value <span class="sc">*</span> post_allocation_us <span class="sc">*</span> post_net_return_us</span>
<span id="cb19-146"><a href="#cb19-146" aria-hidden="true" tabindex="-1"></a>  post_fv_international <span class="ot">&lt;-</span> post_retirement_account_value <span class="sc">*</span> post_allocation_international <span class="sc">*</span> post_net_return_international</span>
<span id="cb19-147"><a href="#cb19-147" aria-hidden="true" tabindex="-1"></a>  post_fv_bonds <span class="ot">&lt;-</span> post_retirement_account_value <span class="sc">*</span> post_allocation_bonds <span class="sc">*</span> post_net_return_bonds</span>
<span id="cb19-148"><a href="#cb19-148" aria-hidden="true" tabindex="-1"></a>  post_fv_short_term <span class="ot">&lt;-</span> post_retirement_account_value <span class="sc">*</span> post_allocation_short_term <span class="sc">*</span> post_net_return_short_term</span>
<span id="cb19-149"><a href="#cb19-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-150"><a href="#cb19-150" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the total value after growth</span></span>
<span id="cb19-151"><a href="#cb19-151" aria-hidden="true" tabindex="-1"></a>  post_retirement_account_value <span class="ot">&lt;-</span> post_fv_us <span class="sc">+</span> post_fv_international <span class="sc">+</span> post_fv_bonds <span class="sc">+</span> post_fv_short_term</span>
<span id="cb19-152"><a href="#cb19-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-153"><a href="#cb19-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the account value for the current year</span></span>
<span id="cb19-154"><a href="#cb19-154" aria-hidden="true" tabindex="-1"></a>  post_retirement_account_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(post_retirement_account_df, <span class="fu">data.frame</span>(<span class="at">age =</span> age, <span class="at">account_value =</span> <span class="fu">round</span>(post_retirement_account_value,<span class="dv">0</span>)))</span>
<span id="cb19-155"><a href="#cb19-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-156"><a href="#cb19-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update previous_account_value for the next year</span></span>
<span id="cb19-157"><a href="#cb19-157" aria-hidden="true" tabindex="-1"></a>  previous_account_value <span class="ot">&lt;-</span> post_retirement_account_value</span>
<span id="cb19-158"><a href="#cb19-158" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-159"><a href="#cb19-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-160"><a href="#cb19-160" aria-hidden="true" tabindex="-1"></a><span class="co"># add columns for annual and monthly incomes at each age</span></span>
<span id="cb19-161"><a href="#cb19-161" aria-hidden="true" tabindex="-1"></a>post_retirement_account_df <span class="ot">&lt;-</span> post_retirement_account_df <span class="sc">|&gt;</span></span>
<span id="cb19-162"><a href="#cb19-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">annual_income =</span> <span class="fu">round</span>(account_value<span class="sc">*</span><span class="fl">0.04</span>,<span class="dv">0</span>),</span>
<span id="cb19-163"><a href="#cb19-163" aria-hidden="true" tabindex="-1"></a>         <span class="at">monthly_income =</span> <span class="fu">round</span>(annual_income<span class="sc">/</span><span class="dv">12</span>,<span class="dv">0</span>))</span>
<span id="cb19-164"><a href="#cb19-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-165"><a href="#cb19-165" aria-hidden="true" tabindex="-1"></a><span class="co"># average monthly income post retirement</span></span>
<span id="cb19-166"><a href="#cb19-166" aria-hidden="true" tabindex="-1"></a>OPR_avg_monthly_income <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(post_retirement_account_df<span class="sc">$</span>monthly_income),<span class="dv">0</span>)</span>
<span id="cb19-167"><a href="#cb19-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-168"><a href="#cb19-168" aria-hidden="true" tabindex="-1"></a><span class="co"># adjusted for display purposes only</span></span>
<span id="cb19-169"><a href="#cb19-169" aria-hidden="true" tabindex="-1"></a>post_retirement_account_df_table <span class="ot">&lt;-</span> post_retirement_account_df <span class="sc">|&gt;</span></span>
<span id="cb19-170"><a href="#cb19-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">!=</span> <span class="dv">62</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-171"><a href="#cb19-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb19-172"><a href="#cb19-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> age,</span>
<span id="cb19-173"><a href="#cb19-173" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Retirement Account Value (USD)</span><span class="st">`</span> <span class="ot">=</span> account_value,</span>
<span id="cb19-174"><a href="#cb19-174" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Annual Withdrawal (USD)</span><span class="st">`</span> <span class="ot">=</span> annual_income,</span>
<span id="cb19-175"><a href="#cb19-175" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Monthly Income (USD)</span><span class="st">`</span> <span class="ot">=</span> monthly_income</span>
<span id="cb19-176"><a href="#cb19-176" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-177"><a href="#cb19-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-178"><a href="#cb19-178" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(post_retirement_account_df_table, <span class="at">caption =</span> <span class="st">"ORP Income During Retirement"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-ad5ad5593e0bbb3d4a1c" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ad5ad5593e0bbb3d4a1c">{"x":{"filter":"none","vertical":false,"caption":"<caption>ORP Income During Retirement<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18"],[63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80],[1971299,1927764,1885190,1843556,1802842,1763027,1724091,1686015,1648780,1612367,1576759,1541937,1521783,1501893,1482262,1462888,1443768,1424897],[78852,77111,75408,73742,72114,70521,68964,67441,65951,64495,63070,61677,60871,60076,59290,58516,57751,56996],[6571,6426,6284,6145,6010,5877,5747,5620,5496,5375,5256,5140,5073,5006,4941,4876,4813,4750]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Age<\/th>\n      <th>Retirement Account Value (USD)<\/th>\n      <th>Annual Withdrawal (USD)<\/th>\n      <th>Monthly Income (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Age","targets":1},{"name":"Retirement Account Value (USD)","targets":2},{"name":"Annual Withdrawal (USD)","targets":3},{"name":"Monthly Income (USD)","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We see that each plan offers a different amount of returns during the retirement period. From a quick glance, the TRS plan provides a higher income in retirement compared to the ORP plan. In fact, the TRS income increases over time while the ORP income decreases as the funds are exhausted from withdrawing.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the comparison</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>plan_comparison <span class="ot">&lt;-</span> annual_retirement_benefit_inflation_adjusted <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    post_retirement_account_df,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(age <span class="sc">==</span> age)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age, monthly_benefit, monthly_income)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plan_comparison, <span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> monthly_benefit, <span class="at">color =</span> <span class="st">"TRS Plan"</span>)) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> monthly_income, <span class="at">color =</span> <span class="st">"ORP Plan"</span>)) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparison of TRS &amp; ORP Plans by Age"</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Age"</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Monthly Income"</span>,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Retirement Plan"</span>) <span class="sc">+</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>)) <span class="sc">+</span>  <span class="co"># Customize colors</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on the data we’ve acquired we can uncover some insights:</p>
<p><em>Whether the employee runs out of funds before death and/or has funds to leave to heirs (ORP only)</em></p>
<p>Assuming that the life expectancy is 80 years old, there is left over money in the retirement account to be inherited. This is assuming a constant 4% annual withdrawal rate until death. If the person lives longer or withdraws more this may change.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ORP_funds <span class="ot">&lt;-</span> post_retirement_account_df_table <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age <span class="sc">==</span> <span class="dv">80</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Age, <span class="st">`</span><span class="at">Retirement Account Value (USD)</span><span class="st">`</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(ORP_funds, <span class="at">caption =</span> <span class="st">"Funds Left at Death"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-4d0d325e7fa429d68dfa" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4d0d325e7fa429d68dfa">{"x":{"filter":"none","vertical":false,"caption":"<caption>Funds Left at Death<\/caption>","data":[["1"],[80],[1424897]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Age<\/th>\n      <th>Retirement Account Value (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Age","targets":1},{"name":"Retirement Account Value (USD)","targets":2}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><em>Average monthly income (TRS vs ORP)</em></p>
<p>On average the TRS plan provides a higher average monthly income. Again keep in mind that this is based on factors we’ve established beforehand: starting salary, starting employment age, and number of years worked before retirement. We’ll take a look at how the outcomes could be different when the parameters change later.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The average monthly income with the TRS plan is"</span>, TRS_avg_monthly_income, <span class="st">"dollars."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The average monthly income with the TRS plan is 8082 dollars."</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The average monthly income with the ORP plan is"</span>, OPR_avg_monthly_income, <span class="st">"dollars."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The average monthly income with the ORP plan is 5586 dollars."</code></pre>
</div>
</div>
<p><em>Maximum and minimum gap in monthly income between TRS and ORP</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>income_gap <span class="ot">&lt;-</span> annual_retirement_benefit_inflation_adjusted <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    post_retirement_account_df,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">join_by</span>(age <span class="sc">==</span> age)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income_difference =</span> monthly_benefit <span class="sc">-</span> monthly_income) <span class="sc">|&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age, income_difference) <span class="sc">|&gt;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(income_difference <span class="sc">==</span> <span class="fu">max</span>(income_difference) <span class="sc">|</span> income_difference <span class="sc">==</span> <span class="fu">min</span>(income_difference))</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the two ages for plotting use</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>ages_to_display <span class="ot">&lt;-</span> <span class="fu">unique</span>(income_gap<span class="sc">$</span>age)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># display the two specific ages on the plot</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>income_gap <span class="ot">&lt;-</span> income_gap <span class="sc">|&gt;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">factor</span>(age, <span class="at">levels =</span> ages_to_display))</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(income_gap, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> income_difference)) <span class="sc">+</span> </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"cadetblue2"</span> ) <span class="sc">+</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Maximum &amp; Minimum Income Difference by Age"</span>, <span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Income Difference"</span>) <span class="sc">+</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The smallest income gap happens during the first year of retirement with a difference of $656. The largest income gap occurs at the end of the life expectancy with a difference of $4252.</p>
</section>
<section id="bootstrap-monte-carlo-comparison" class="level3">
<h3 class="anchored" data-anchor-id="bootstrap-monte-carlo-comparison">Bootstrap (Monte Carlo) Comparison</h3>
<p>Bootstrapping data or performing a Monte Carlo analysis allows us to dive into further uncertainty in our data. By simulating a wide range of possible outcomes based on a model’s input variables, this method provides a comprehensive view of potential results, allowing analysts to evaluate the likelihood of various scenarios. It helps quantify risks, enabling decision-makers to make informed choices by assessing the probabilities of success or failure associated with different strategies. We’ll take a look at bootstrapping our historical data to get a better understanding of our results from beforehand.</p>
<p>By introducing a Monte Carlo analysis, we can generate more potential scenarios for the TRS and ORP plan results. The above analysis was strictly based on on instance in history and not representative of all outcomes possible. The following bootstrap comparison will show us that there are other potential outcomes in each plan.</p>
<p>First we can take a look at the chances of exhausting the ORP plan before death. This is assuming that the life expectancy is 80 and the withdrawal rate is still 4% annually.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Task 7: Monte Carlo Analysis</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability of savings exhaustion</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize parameters</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>n_bootstrap <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>savings_exhausted <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_bootstrap) <span class="co"># set vector for any bootstrap accounts exhausted</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>post_retirement_results <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, n_bootstrap) <span class="co"># combine all iterations into one list</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Main loop for bootstrap samples</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_bootstrap) {</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bootstrap sample from historical financial series</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  bootstrap_sample <span class="ot">&lt;-</span> historical_financial_series <span class="sc">|&gt;</span> </span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="fu">nrow</span>(historical_financial_series), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize retirement data frame</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  retirement_account <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">period =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bootstrap_sample),</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">allocation_us =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(bootstrap_sample)),</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">allocation_international =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(bootstrap_sample)),</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">allocation_bonds =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(bootstrap_sample)),</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">allocation_short_term =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(bootstrap_sample)),</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">us_returns =</span> bootstrap_sample<span class="sc">$</span>spy_return_percent <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">international_returns =</span> bootstrap_sample<span class="sc">$</span>FDIVX_return_percent <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">bonds_returns =</span> bootstrap_sample<span class="sc">$</span>bond_return_percent_value <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_term_returns =</span> bootstrap_sample<span class="sc">$</span>short_term_yield_percent_value <span class="sc">/</span> <span class="dv">100</span>,</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">contribution_employee =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(bootstrap_sample)),</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">contribution_employer =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(bootstrap_sample))</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>  bootstrap_salary_growth_rate <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_sample<span class="sc">$</span>wage_percent_change_from_a_year_ago<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  bootstrap_tenured_salary <span class="ot">&lt;-</span> starting_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> bootstrap_salary_growth_rate)<span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span>years_worked)</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Populate contributions and allocations based on age and salary</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (month <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(retirement_account)) {</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>    year <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(month <span class="sc">/</span> <span class="dv">12</span>)</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>    age <span class="ot">&lt;-</span> <span class="dv">42</span> <span class="sc">+</span> (year <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    annual_salary <span class="ot">&lt;-</span> bootstrap_tenured_salary[year]</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate contributions based on salary bracket</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">45000</span>) {</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.03</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">55000</span>) {</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.035</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">75000</span>) {</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.045</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (annual_salary <span class="sc">&lt;=</span> <span class="dv">100000</span>) {</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.0575</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>contribution_employee[month] <span class="ot">&lt;-</span> annual_salary <span class="sc">*</span> <span class="fl">0.06</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    retirement_account<span class="sc">$</span>contribution_employer[month] <span class="ot">&lt;-</span> <span class="cf">if</span> (year <span class="sc">&lt;=</span> <span class="dv">7</span>) annual_salary <span class="sc">*</span> <span class="fl">0.08</span> <span class="sc">/</span> <span class="dv">12</span> <span class="cf">else</span> annual_salary <span class="sc">*</span> <span class="fl">0.10</span> <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Allocations based on age</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">49</span>) {</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.54</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.36</span></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.10</span></span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">59</span>) {</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.47</span></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.32</span></span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.21</span></span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">74</span>) {</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.34</span></span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.23</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.43</span></span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_us[month] <span class="ot">&lt;-</span> <span class="fl">0.19</span></span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_international[month] <span class="ot">&lt;-</span> <span class="fl">0.13</span></span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_bonds[month] <span class="ot">&lt;-</span> <span class="fl">0.62</span></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>      retirement_account<span class="sc">$</span>allocation_short_term[month] <span class="ot">&lt;-</span> <span class="fl">0.06</span></span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate future value using compound interest</span></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>  retirement_account_value <span class="ot">&lt;-</span> retirement_account <span class="sc">|&gt;</span></span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>      <span class="co"># total contribution per month</span></span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">contribution_total =</span> contribution_employee <span class="sc">+</span> contribution_employer,</span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>      <span class="co"># net total return factors for each asset with compounding</span></span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">net_return_us =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(us_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">net_return_international =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(international_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">net_return_bonds =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(bonds_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">net_return_short_term =</span> <span class="fu">order_by</span>(<span class="fu">desc</span>(period), <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">lead</span>(short_term_returns, <span class="at">default =</span> <span class="dv">0</span>))),</span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a>      <span class="co"># future value of contributions per asset class</span></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">fv_us =</span> contribution_total <span class="sc">*</span> allocation_us <span class="sc">*</span> net_return_us,</span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">fv_international =</span> contribution_total <span class="sc">*</span> allocation_international <span class="sc">*</span> net_return_international,</span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">fv_bonds =</span> contribution_total <span class="sc">*</span> allocation_bonds <span class="sc">*</span> net_return_bonds,</span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>      <span class="at">fv_short_term =</span> contribution_total <span class="sc">*</span> allocation_short_term <span class="sc">*</span> net_return_short_term</span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">account_value =</span> <span class="fu">sum</span>(fv_us <span class="sc">+</span> fv_international <span class="sc">+</span> fv_bonds <span class="sc">+</span> fv_short_term) <span class="co"># total future value of the retirement account</span></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(account_value)</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Post-retirement calculations for ages 62 to 80</span></span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a>  post_retirement_account_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="fu">integer</span>(), <span class="at">account_value =</span> <span class="fu">numeric</span>())</span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a>  withdrawal_rate <span class="ot">&lt;-</span> <span class="fl">0.07</span></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a>  previous_account_value <span class="ot">&lt;-</span> retirement_account_value</span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop through ages 62 to 80, applying withdrawals and growth</span></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (age <span class="cf">in</span> <span class="dv">62</span><span class="sc">:</span><span class="dv">80</span>) {</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate the withdrawal amount based on withdrawal rate</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a>    computed_withdrawal <span class="ot">&lt;-</span> previous_account_value <span class="sc">*</span> withdrawal_rate</span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set the annual withdrawal to at least $60,000 for minimum living expenses</span></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a>    annual_withdrawal <span class="ot">&lt;-</span> <span class="fu">max</span>(computed_withdrawal, <span class="dv">60000</span>)</span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Deduct withdrawal from account</span></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a>    post_retirement_account_value <span class="ot">&lt;-</span> previous_account_value <span class="sc">-</span> annual_withdrawal</span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define allocations based on age</span></span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (age <span class="sc">&lt;=</span> <span class="dv">74</span>) {</span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a>      post_allocation_us <span class="ot">&lt;-</span> <span class="fl">0.34</span></span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a>      post_allocation_international <span class="ot">&lt;-</span> <span class="fl">0.23</span></span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a>      post_allocation_bonds <span class="ot">&lt;-</span> <span class="fl">0.43</span></span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a>      post_allocation_short_term <span class="ot">&lt;-</span> <span class="fl">0.00</span></span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb27-126"><a href="#cb27-126" aria-hidden="true" tabindex="-1"></a>      post_allocation_us <span class="ot">&lt;-</span> <span class="fl">0.19</span></span>
<span id="cb27-127"><a href="#cb27-127" aria-hidden="true" tabindex="-1"></a>      post_allocation_international <span class="ot">&lt;-</span> <span class="fl">0.13</span></span>
<span id="cb27-128"><a href="#cb27-128" aria-hidden="true" tabindex="-1"></a>      post_allocation_bonds <span class="ot">&lt;-</span> <span class="fl">0.62</span></span>
<span id="cb27-129"><a href="#cb27-129" aria-hidden="true" tabindex="-1"></a>      post_allocation_short_term <span class="ot">&lt;-</span> <span class="fl">0.06</span></span>
<span id="cb27-130"><a href="#cb27-130" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb27-131"><a href="#cb27-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-132"><a href="#cb27-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate future value of the remaining balance after applying returns for the year</span></span>
<span id="cb27-133"><a href="#cb27-133" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply returns based on age (mapping current year returns for the remaining account value)</span></span>
<span id="cb27-134"><a href="#cb27-134" aria-hidden="true" tabindex="-1"></a>    post_fv_us <span class="ot">&lt;-</span> post_retirement_account_value <span class="sc">*</span> post_allocation_us <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> retirement_account<span class="sc">$</span>us_returns[age <span class="sc">-</span> <span class="dv">61</span>])</span>
<span id="cb27-135"><a href="#cb27-135" aria-hidden="true" tabindex="-1"></a>    post_fv_international <span class="ot">&lt;-</span> post_retirement_account_value <span class="sc">*</span> post_allocation_international <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> retirement_account<span class="sc">$</span>international_returns[age <span class="sc">-</span> <span class="dv">61</span>])</span>
<span id="cb27-136"><a href="#cb27-136" aria-hidden="true" tabindex="-1"></a>    post_fv_bonds <span class="ot">&lt;-</span> post_retirement_account_value <span class="sc">*</span> post_allocation_bonds <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> retirement_account<span class="sc">$</span>bonds_returns[age <span class="sc">-</span> <span class="dv">61</span>])</span>
<span id="cb27-137"><a href="#cb27-137" aria-hidden="true" tabindex="-1"></a>    post_fv_short_term <span class="ot">&lt;-</span> post_retirement_account_value <span class="sc">*</span> post_allocation_short_term <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> retirement_account<span class="sc">$</span>short_term_returns[age <span class="sc">-</span> <span class="dv">61</span>])</span>
<span id="cb27-138"><a href="#cb27-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-139"><a href="#cb27-139" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Total value after applying returns to the remaining balance</span></span>
<span id="cb27-140"><a href="#cb27-140" aria-hidden="true" tabindex="-1"></a>    post_retirement_account_value <span class="ot">&lt;-</span> post_fv_us <span class="sc">+</span> post_fv_international <span class="sc">+</span> post_fv_bonds <span class="sc">+</span> post_fv_short_term</span>
<span id="cb27-141"><a href="#cb27-141" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-142"><a href="#cb27-142" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store the account value at the end of each year</span></span>
<span id="cb27-143"><a href="#cb27-143" aria-hidden="true" tabindex="-1"></a>    post_retirement_account_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(post_retirement_account_df, <span class="fu">data.frame</span>(<span class="at">age =</span> age, <span class="at">account_value =</span> <span class="fu">round</span>(post_retirement_account_value, <span class="dv">0</span>)))</span>
<span id="cb27-144"><a href="#cb27-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-145"><a href="#cb27-145" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the previous account value for the next loop iteration</span></span>
<span id="cb27-146"><a href="#cb27-146" aria-hidden="true" tabindex="-1"></a>    previous_account_value <span class="ot">&lt;-</span> post_retirement_account_value</span>
<span id="cb27-147"><a href="#cb27-147" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-148"><a href="#cb27-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-149"><a href="#cb27-149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add income columns for post-retirement</span></span>
<span id="cb27-150"><a href="#cb27-150" aria-hidden="true" tabindex="-1"></a>  post_retirement_account_df <span class="ot">&lt;-</span> post_retirement_account_df <span class="sc">|&gt;</span> </span>
<span id="cb27-151"><a href="#cb27-151" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">annual_income =</span> <span class="fu">round</span>(account_value <span class="sc">*</span> withdrawal_rate, <span class="dv">0</span>),</span>
<span id="cb27-152"><a href="#cb27-152" aria-hidden="true" tabindex="-1"></a>           <span class="at">monthly_income =</span> <span class="fu">round</span>(annual_income <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">0</span>))</span>
<span id="cb27-153"><a href="#cb27-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-154"><a href="#cb27-154" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the results</span></span>
<span id="cb27-155"><a href="#cb27-155" aria-hidden="true" tabindex="-1"></a>  post_retirement_results[[i]] <span class="ot">&lt;-</span> post_retirement_account_df</span>
<span id="cb27-156"><a href="#cb27-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb27-157"><a href="#cb27-157" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if any savings were exhausted</span></span>
<span id="cb27-158"><a href="#cb27-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(post_retirement_account_df<span class="sc">$</span>account_value <span class="sc">&lt;=</span> <span class="dv">0</span>)) {</span>
<span id="cb27-159"><a href="#cb27-159" aria-hidden="true" tabindex="-1"></a>    savings_exhausted[i] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb27-160"><a href="#cb27-160" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb27-161"><a href="#cb27-161" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-162"><a href="#cb27-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-163"><a href="#cb27-163" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"The probability of exhausting the ORP plan before death is"</span>, <span class="fu">mean</span>(savings_exhausted),<span class="st">"."</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "The probability of exhausting the ORP plan before death is 0 ."</code></pre>
</div>
</div>
<p>The chances of exhausting the ORP funds in this simulation is 0. However, we should take a deeper look into the breakdown of the account value of the years to get a full understanding of how much is being exhausted each year. We’ll take a look at a sample bootstrapped output for the ORP plan. We can see that even with the bootstrapped data, there are still plenty of funds left over for inheritance.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ORP_bootstrap_example <span class="ot">&lt;-</span> post_retirement_results[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Age =</span> age,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Account Value (USD)</span><span class="st">`</span> <span class="ot">=</span> account_value,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Annual Withdrawal (USD)</span><span class="st">`</span> <span class="ot">=</span> annual_income,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Monthly Income (USD)</span><span class="st">`</span> <span class="ot">=</span> monthly_income</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(ORP_bootstrap_example, <span class="at">caption =</span> <span class="st">"Sample Bootstrapped ORP Output"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-0b234b68bf55362f3851" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-0b234b68bf55362f3851">{"x":{"filter":"none","vertical":false,"caption":"<caption>Sample Bootstrapped ORP Output<\/caption>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19"],[62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80],[2960993,2769857,2593419,2459647,2297115,2164563,2040745,1918672,1813394,1720850,1632087,1534459,1440671,1358273,1279375,1199247,1129587,1061092,997728],[207270,193890,181539,172175,160798,151519,142852,134307,126938,120460,114246,107412,100847,95079,89556,83947,79071,74276,69841],[17272,16158,15128,14348,13400,12627,11904,11192,10578,10038,9520,8951,8404,7923,7463,6996,6589,6190,5820]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Age<\/th>\n      <th>Account Value (USD)<\/th>\n      <th>Annual Withdrawal (USD)<\/th>\n      <th>Monthly Income (USD)<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Age","targets":1},{"name":"Account Value (USD)","targets":2},{"name":"Annual Withdrawal (USD)","targets":3},{"name":"Monthly Income (USD)","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Next we examine the probability that an ORP employee has a higher monthly income in retirement than a TRS employee. Using the 200 bootstrapped history simulation, we compare the average monthly income in each instance to see how many times the ORP plan outperformed the TRS plan.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get TRS dataframe list from bootstrap history first to compare the ORP already calculated </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>n_bootstrap <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store the results</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>bootstrap_TRS_results <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, n_bootstrap)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_bootstrap) {</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bootstrap sample from historical financial series</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  bootstrap_sample <span class="ot">&lt;-</span> historical_financial_series <span class="sc">|&gt;</span> </span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="fu">nrow</span>(historical_financial_series), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate growth rate and tenured salary</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  bootstrap_salary_growth_rate <span class="ot">&lt;-</span> <span class="fu">mean</span>(bootstrap_sample<span class="sc">$</span>wage_percent_change_from_a_year_ago) <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  bootstrap_tenured_salary <span class="ot">&lt;-</span> starting_salary <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> bootstrap_salary_growth_rate)<span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span>years_worked)</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the Final Average Salary (FAS)</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  bootstrap_FAS <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">tail</span>(bootstrap_tenured_salary, <span class="dv">3</span>))</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the annual retirement benefit</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  bootstrap_annual_retirement_benefit <span class="ot">&lt;-</span> (<span class="fl">0.35</span> <span class="sc">+</span> <span class="fl">0.02</span> <span class="sc">*</span> years_worked) <span class="sc">*</span> bootstrap_FAS</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate CPI benefit</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  bootstrap_CPI_benefit <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">mean</span>(bootstrap_sample<span class="sc">$</span>inflation_percent_change, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">*</span> <span class="dv">12</span> <span class="sc">/</span><span class="dv">100</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  bootstrap_annual_retirement_benefit_inflation_adjusted <span class="ot">&lt;-</span> <span class="fu">round</span>(bootstrap_annual_retirement_benefit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> bootstrap_CPI_benefit)<span class="sc">^</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">17</span>), <span class="dv">0</span>) <span class="co"># (0:17) creates a vector for the next 18 years of inflation adjusted income</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert the numeric vector to a data frame with ages</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>  bootstrap_annual_retirement_benefit_inflation_adjusted_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="dv">63</span><span class="sc">:</span><span class="dv">80</span>, <span class="co"># Create a column for ages from 63 to 80</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">annual_benefit =</span> bootstrap_annual_retirement_benefit_inflation_adjusted,</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">monthly_benefit =</span> <span class="fu">round</span>(bootstrap_annual_retirement_benefit_inflation_adjusted <span class="sc">/</span> <span class="dv">12</span>, <span class="dv">0</span>)</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the data frame in the list</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  bootstrap_TRS_results[[i]] <span class="ot">&lt;-</span> bootstrap_annual_retirement_benefit_inflation_adjusted_df</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="co"># mean monthly income of each TRS bootstrap history dataframe</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>mean_TRS_monthly_benefits <span class="ot">&lt;-</span> <span class="fu">sapply</span>(bootstrap_TRS_results, <span class="cf">function</span>(df) <span class="fu">mean</span>(df<span class="sc">$</span>monthly_benefit, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="co"># mean monthly income of each ORP bootstrap history dataframe</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>mean_ORP_monthly_income <span class="ot">&lt;-</span> <span class="fu">sapply</span>(post_retirement_results, <span class="cf">function</span>(df) <span class="fu">mean</span>(df<span class="sc">$</span>monthly_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a><span class="co"># compare the two plans</span></span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of times ORP monthly income is greater than TRS monthly benefits</span></span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>greater_than_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(mean_ORP_monthly_income <span class="sc">&gt;</span> mean_TRS_monthly_benefits)</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the total number of comparisons (which should be the same length for both vectors)</span></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>total_comparisons <span class="ot">&lt;-</span> <span class="fu">length</span>(mean_TRS_monthly_benefits)</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the probability</span></span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>probability_ORP_greater <span class="ot">&lt;-</span> (greater_than_count <span class="sc">/</span> total_comparisons)<span class="sc">*</span><span class="dv">100</span></span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The probability that the ORP plan has a greater monthly income than TRS is:"</span>, probability_ORP_greater, <span class="st">"%."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>The probability that the ORP plan has a greater monthly income than TRS is: 72.5 %.</code></pre>
</div>
</div>
<p>To get a better idea of this calculated probability, we can look into the distribution of the mean income by age in each plan. The ORP plan has a wider distribution of potential monthly income where as the TRS is more concentrated with less variability.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>average_monthly_plan_incomes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(mean_TRS_monthly_benefits, mean_ORP_monthly_income),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Group =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"TRS"</span>, <span class="fu">length</span>(mean_TRS_monthly_benefits)), <span class="fu">rep</span>(<span class="st">"ORP"</span>, <span class="fu">length</span>(mean_ORP_monthly_income)))</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(average_monthly_plan_incomes, <span class="fu">aes</span>(<span class="at">x =</span> Group, <span class="at">y =</span> Value)) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">height =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparing TRS vs. ORP Plan Results"</span>, <span class="at">x =</span> <span class="st">"Plan Type"</span>, <span class="at">y =</span> <span class="st">"Average Monthly Income (USD)"</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Lastly, we can compare the distribution of the average monthly income in each plan generated from the bootstrap history through a histogram. The TRS distribution closely follows a normal distribution curve, while the ORP distribution shows similarity to a bimodal distribution instead.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">Income =</span> mean_ORP_monthly_income), <span class="fu">aes</span>(<span class="at">x =</span> Income)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">100</span>, <span class="at">fill =</span> <span class="st">"darkseagreen3"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Average Monthly Income (ORP)"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Generated From 200 Bootstrap Histories"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Average Monthly Income (USD)"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">Income =</span> mean_TRS_monthly_benefits), <span class="fu">aes</span>(<span class="at">x =</span> Income)) <span class="sc">+</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">100</span>, <span class="at">fill =</span> <span class="st">"palevioletred"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram of Average Monthly Income (TRS)"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Generated From 200 Bootstrap Histories"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Average Monthly Income (USD)"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-driven-decision-recommendation" class="level2">
<h2 class="anchored" data-anchor-id="data-driven-decision-recommendation">Data-Driven Decision Recommendation</h2>
<p>Based on the analysis, the ORP plan may be the better retirement option for an employee. This is not financial advice that should be taken by every potential employee. The specific circumstances for this employee lead us to choosing this plan. Instead we need to consider the personal factors of anyone deciding on what plan to use. That employee should consider their own age, starting salary, length of tenure, and their risk factor for investing.</p>
<p>If the employee is younger (20-30s) and is willing to risk their investments in the market, I would recommend taking the ORP plan. They’ll have more time for their investment to compound and grow, assuming they’ll retire after working more than 20 years. For those who are older, having a shorter tenure or are risk averse; I would recommend signing up for the TRS plan instead as the income will be guaranteed and steady.</p>
<p>The factor I’d like to emphasize the most is risk. Those who want a guaranteed safety blanket should stick with the TRS plan. They don’t have to worry about downturns in the market, unexpected long life expectancy or running out of income one day. If these factors don’t deter you, you may want to consider taking the ORP plan instead.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/cliu98\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>